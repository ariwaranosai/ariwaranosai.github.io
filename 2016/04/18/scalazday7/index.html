<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="这一部分展示了关于State Monad的例子以及使用。">
<meta name="keywords" content="Scala">
<meta property="og:type" content="article">
<meta property="og:title" content="learning Scalaz-day7">
<meta property="og:url" content="http://ariwaranosai.xyz/2016/04/18/scalazday7/index.html">
<meta property="og:site_name" content="浑浑噩噩の佐為">
<meta property="og:description" content="这一部分展示了关于State Monad的例子以及使用。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-11-12T15:10:26.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="learning Scalaz-day7">
<meta name="twitter:description" content="这一部分展示了关于State Monad的例子以及使用。">






  <link rel="canonical" href="http://ariwaranosai.xyz/2016/04/18/scalazday7/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>learning Scalaz-day7 | 浑浑噩噩の佐為</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">浑浑噩噩の佐為</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://ariwaranosai.xyz/2016/04/18/scalazday7/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ariwaranosai">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浑浑噩噩の佐為">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">learning Scalaz-day7

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2016-04-18 20:29:23" itemprop="dateCreated datePublished" datetime="2016-04-18T20:29:23+08:00">2016-04-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2018-11-12 23:10:26" itemprop="dateModified" datetime="2018-11-12T23:10:26+08:00">2018-11-12</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Scalaz翻译/" itemprop="url" rel="index"><span itemprop="name">Scalaz翻译</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>这一部分展示了关于<code>State Monad</code>的例子以及使用。</p>
<a id="more"></a>
<h3 id="tasteful-stateful-computations">Tasteful stateful computations</h3>
<blockquote>
<p>Haskell features a thing called the state monad, which makes dealing with stateful problems a breeze while still keeping everything nice and pure.</p>
</blockquote>
<p>一个简单的例子就是<code>Stack</code>，这是一个典型的保存状态的计算。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">Stack</span> </span>= <span class="type">List</span>[<span class="type">Int</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pop</span></span>(stack: <span class="type">Stack</span>): (<span class="type">Int</span>, <span class="type">Stack</span>) = stack <span class="keyword">match</span> &#123;</span><br><span class="line">  <span class="keyword">case</span> x::xs =&gt; (x, xs)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">push</span></span>(a: <span class="type">Int</span>, stack: <span class="type">Stack</span>): (<span class="type">Unit</span>, <span class="type">Stack</span>) = ((), a :: stack)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stackManip</span></span>(stack: <span class="type">Stack</span>): (<span class="type">Int</span>, <span class="type">Stack</span>) = &#123;</span><br><span class="line">  <span class="keyword">val</span> (_, newStack1) = push(<span class="number">3</span>, stack)</span><br><span class="line">  <span class="keyword">val</span> (a, newStack2) = pop(newStack1)</span><br><span class="line">  pop(newStack2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stackManip(<span class="type">List</span>(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">2</span>))</span><br></pre></td></tr></table></figure>
<h3 id="state-and-statet">State and StateT</h3>
<blockquote>
<p>We’ll say that a stateful computation is a function that takes some state and returns a value along with some new state. That function would have the following type:</p>
</blockquote>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s -&gt; (a, s)</span><br></pre></td></tr></table></figure>
<p>在<code>Scalaz</code>中的<code>State</code>大概是这个样子的</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">State</span>[<span class="type">S</span>, +<span class="type">A</span>] </span>= <span class="type">StateT</span>[<span class="type">Id</span>, <span class="type">S</span>, <span class="type">A</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment">// important to define here, rather than at the top-level, to avoid Scala 2.9.2 bug</span></span><br><span class="line">  <span class="class"><span class="keyword">object</span> <span class="title">State</span> <span class="keyword">extends</span> <span class="title">StateFunctions</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[<span class="type">S</span>, <span class="type">A</span>](f: <span class="type">S</span> =&gt; (<span class="type">S</span>, <span class="type">A</span>)): <span class="type">State</span>[<span class="type">S</span>, <span class="type">A</span>] = <span class="keyword">new</span> <span class="type">StateT</span>[<span class="type">Id</span>, <span class="type">S</span>, <span class="type">A</span>] &#123;</span><br><span class="line">      <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(s: <span class="type">S</span>) = f(s)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>这里可以看到<code>State</code>一个特殊的地方，他固定了函数的形式<code>f: S =&gt; (S, A)</code>。这里的<code>StateT</code>大概是</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">StateT</span>[<span class="type">F</span>[+_], <span class="title">S</span>, <span class="title">+A</span>] </span>&#123; self =&gt;</span><br><span class="line">  <span class="comment">/** Run and return the final value and state in the context of `F` */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(initial: <span class="type">S</span>): <span class="type">F</span>[(<span class="type">S</span>, <span class="type">A</span>)]</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** An alias for `apply` */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">run</span></span>(initial: <span class="type">S</span>): <span class="type">F</span>[(<span class="type">S</span>, <span class="type">A</span>)] = apply(initial)</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Calls `run` using `Monoid[S].zero` as the initial state */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">runZero</span></span>(<span class="keyword">implicit</span> <span class="type">S</span>: <span class="type">Monoid</span>[<span class="type">S</span>]): <span class="type">F</span>[(<span class="type">S</span>, <span class="type">A</span>)] =</span><br><span class="line">    run(<span class="type">S</span>.zero)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义一个<code>State</code>需要指定具体的<code>S =&gt; (S, A)</code>的函数。可以使用下面的语法直接构造一个<code>State</code>。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">StateFunctions</span> <span class="keyword">extends</span> <span class="title">IndexedStateFunctions</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">constantState</span></span>[<span class="type">S</span>, <span class="type">A</span>](a: <span class="type">A</span>, s: =&gt; <span class="type">S</span>): <span class="type">State</span>[<span class="type">S</span>, <span class="type">A</span>] =</span><br><span class="line">    <span class="type">State</span>((_: <span class="type">S</span>) =&gt; (s, a))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">state</span></span>[<span class="type">S</span>, <span class="type">A</span>](a: <span class="type">A</span>): <span class="type">State</span>[<span class="type">S</span>, <span class="type">A</span>] =</span><br><span class="line">    <span class="type">State</span>((_ : <span class="type">S</span>, a))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">init</span></span>[<span class="type">S</span>]: <span class="type">State</span>[<span class="type">S</span>, <span class="type">S</span>] = <span class="type">State</span>(s =&gt; (s, s))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get</span></span>[<span class="type">S</span>]: <span class="type">State</span>[<span class="type">S</span>, <span class="type">S</span>] = init</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">gets</span></span>[<span class="type">S</span>, <span class="type">T</span>](f: <span class="type">S</span> =&gt; <span class="type">T</span>): <span class="type">State</span>[<span class="type">S</span>, <span class="type">T</span>] = <span class="type">State</span>(s =&gt; (s, f(s)))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">put</span></span>[<span class="type">S</span>](s: <span class="type">S</span>): <span class="type">State</span>[<span class="type">S</span>, <span class="type">Unit</span>] = <span class="type">State</span>(_ =&gt; (s, ()))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">modify</span></span>[<span class="type">S</span>](f: <span class="type">S</span> =&gt; <span class="type">S</span>): <span class="type">State</span>[<span class="type">S</span>, <span class="type">Unit</span>] = <span class="type">State</span>(s =&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> r = f(s);</span><br><span class="line">    (r, ())</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过使用语法糖，可以直接通过连续的操作最终得到结果，而不是显示的传递<code>State</code>。</p>
<p>在<code>StateFunctions</code>中还定义了一些辅助函数，</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">StateFunctions</span> <span class="keyword">extends</span> <span class="title">IndexedStateFunctions</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">constantState</span></span>[<span class="type">S</span>, <span class="type">A</span>](a: <span class="type">A</span>, s: =&gt; <span class="type">S</span>): <span class="type">State</span>[<span class="type">S</span>, <span class="type">A</span>] =</span><br><span class="line">    <span class="type">State</span>((_: <span class="type">S</span>) =&gt; (s, a))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">state</span></span>[<span class="type">S</span>, <span class="type">A</span>](a: <span class="type">A</span>): <span class="type">State</span>[<span class="type">S</span>, <span class="type">A</span>] =</span><br><span class="line">    <span class="type">State</span>((_ : <span class="type">S</span>, a))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">init</span></span>[<span class="type">S</span>]: <span class="type">State</span>[<span class="type">S</span>, <span class="type">S</span>] = <span class="type">State</span>(s =&gt; (s, s))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get</span></span>[<span class="type">S</span>]: <span class="type">State</span>[<span class="type">S</span>, <span class="type">S</span>] = init</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">gets</span></span>[<span class="type">S</span>, <span class="type">T</span>](f: <span class="type">S</span> =&gt; <span class="type">T</span>): <span class="type">State</span>[<span class="type">S</span>, <span class="type">T</span>] = <span class="type">State</span>(s =&gt; (s, f(s)))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">put</span></span>[<span class="type">S</span>](s: <span class="type">S</span>): <span class="type">State</span>[<span class="type">S</span>, <span class="type">Unit</span>] = <span class="type">State</span>(_ =&gt; (s, ()))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">modify</span></span>[<span class="type">S</span>](f: <span class="type">S</span> =&gt; <span class="type">S</span>): <span class="type">State</span>[<span class="type">S</span>, <span class="type">Unit</span>] = <span class="type">State</span>(s =&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> r = f(s);</span><br><span class="line">    (r, ())</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里面写的很有意思，首先明确一点，<code>State</code>里面给的是要形如<code>S =&gt; (S, A)</code>的行为，比如对于<code>get</code>我们就是要把状态取出来所以就应该在保持原有状态的时候，将状态也放到取出值的位置上<code>s =&gt; (s, s)</code>。然后，<code>put</code>其实就是为了将状态放过去，<code>_ =&gt; (s, ())</code>。</p>
<p>一个使用的例子可以是这样的</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">  _ &lt;- push(<span class="number">3</span>)</span><br><span class="line">  a &lt;- pop</span><br><span class="line">  b &lt;- <span class="type">State</span>.get</span><br><span class="line">  r &lt;- <span class="keyword">if</span> (b.length &gt; <span class="number">3</span>) <span class="type">State</span>.put(<span class="type">List</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>, <span class="number">5</span>)) <span class="keyword">else</span> <span class="type">State</span>.put(<span class="type">List</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">&#125; <span class="keyword">yield</span> r</span><br></pre></td></tr></table></figure>
<p>同样，我们也可以直接使用<code>get</code>和<code>put</code>去实现<code>pop</code>和<code>push</code>操作。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> pop = <span class="keyword">for</span> &#123;</span><br><span class="line">  s &lt;- get[<span class="type">Stack</span>]</span><br><span class="line">  (x::xs) = s</span><br><span class="line">  _ &lt;- put(xs)</span><br><span class="line">&#125; <span class="keyword">yield</span> x</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">push</span></span>(s: <span class="type">Int</span>) = <span class="keyword">for</span> &#123;</span><br><span class="line">  xs &lt;- get[<span class="type">Stack</span>]</span><br><span class="line">  _ &lt;- put(s::xs)</span><br><span class="line">&#125; <span class="keyword">yield</span> ()</span><br></pre></td></tr></table></figure>
<h3 id="composing-monadic-functions">Composing monadic functions</h3>
<blockquote>
<p>When we were learning about the monad laws, we said that the &lt;=&lt; function is just like composition, only instead of working for normal functions like a -&gt; b, it works for monadic functions like a -&gt; m b.</p>
</blockquote>
<h4 id="kleisli">Kleisli</h4>
<p>在<code>Scalaz</code>中，这就是那个<code>A =&gt; M[B]</code>的封装。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">trait</span> <span class="title">Kleisli</span>[<span class="type">M</span>[+_], <span class="title">-A</span>, <span class="title">+B</span>] </span>&#123; self =&gt;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">run</span></span>(a: <span class="type">A</span>): <span class="type">M</span>[<span class="type">B</span>]</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">/** alias for `andThen` */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">&gt;=&gt;</span></span>[<span class="type">C</span>](k: <span class="type">Kleisli</span>[<span class="type">M</span>, <span class="type">B</span>, <span class="type">C</span>])(<span class="keyword">implicit</span> b: <span class="type">Bind</span>[<span class="type">M</span>]): <span class="type">Kleisli</span>[<span class="type">M</span>, <span class="type">A</span>, <span class="type">C</span>] =</span><br><span class="line">    kleisli((a: <span class="type">A</span>) =&gt; b.bind(<span class="keyword">this</span>(a))(k(_)))</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">andThen</span></span>[<span class="type">C</span>](k: <span class="type">Kleisli</span>[<span class="type">M</span>, <span class="type">B</span>, <span class="type">C</span>])(<span class="keyword">implicit</span> b: <span class="type">Bind</span>[<span class="type">M</span>]): <span class="type">Kleisli</span>[<span class="type">M</span>, <span class="type">A</span>, <span class="type">C</span>] = <span class="keyword">this</span> &gt;=&gt; k</span><br><span class="line">  <span class="comment">/** alias for `compose` */</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">&lt;=&lt;</span></span>[<span class="type">C</span>](k: <span class="type">Kleisli</span>[<span class="type">M</span>, <span class="type">C</span>, <span class="type">A</span>])(<span class="keyword">implicit</span> b: <span class="type">Bind</span>[<span class="type">M</span>]): <span class="type">Kleisli</span>[<span class="type">M</span>, <span class="type">C</span>, <span class="type">B</span>] = k &gt;=&gt; <span class="keyword">this</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">compose</span></span>[<span class="type">C</span>](k: <span class="type">Kleisli</span>[<span class="type">M</span>, <span class="type">C</span>, <span class="type">A</span>])(<span class="keyword">implicit</span> b: <span class="type">Bind</span>[<span class="type">M</span>]): <span class="type">Kleisli</span>[<span class="type">M</span>, <span class="type">C</span>, <span class="type">B</span>] = k &gt;=&gt; <span class="keyword">this</span></span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Kleisli</span> <span class="keyword">extends</span> <span class="title">KleisliFunctions</span> <span class="keyword">with</span> <span class="title">KleisliInstances</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[<span class="type">M</span>[+_], <span class="type">A</span>, <span class="type">B</span>](f: <span class="type">A</span> =&gt; <span class="type">M</span>[<span class="type">B</span>]): <span class="type">Kleisli</span>[<span class="type">M</span>, <span class="type">A</span>, <span class="type">B</span>] = kleisli(f)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最主要的功能就是它的<code>&lt;=&lt;</code>，即把多个处理<code>monad</code>的函数组合起来</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> f = <span class="type">Kleisli</span> &#123; (x: <span class="type">Int</span>) =&gt; (x + <span class="number">1</span>).some &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> g = <span class="type">Kleisli</span> &#123; (x: <span class="type">Int</span>) =&gt; (x * <span class="number">2</span>).some&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>some &gt;&gt;= (f &lt;=&lt; g) <span class="comment">// res: 11</span></span><br><span class="line"><span class="number">5.</span>some &gt;&gt;= (f &gt;=&gt; g) <span class="comment">// res: 12</span></span><br></pre></td></tr></table></figure>
<h4 id="reader-as-kleisli">Reader as Kleisli</h4>
<p><code>Scalaz</code>中定义通过<code>Kleisli</code>来定义<code>ReaderT</code>。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">ReaderT</span>[<span class="type">F</span>[+_], <span class="title">E</span>, <span class="title">A</span>] </span>= <span class="type">Kleisli</span>[<span class="type">F</span>, <span class="type">E</span>, <span class="type">A</span>]</span><br><span class="line"><span class="class"><span class="keyword">type</span> <span class="title">Reader</span>[<span class="type">E</span>, <span class="type">A</span>] </span>= <span class="type">ReaderT</span>[<span class="type">Id</span>, <span class="type">E</span>, <span class="type">A</span>]</span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Reader</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>[<span class="type">E</span>, <span class="type">A</span>](f: <span class="type">E</span> =&gt; <span class="type">A</span>): <span class="type">Reader</span>[<span class="type">E</span>, <span class="type">A</span>] = <span class="type">Kleisli</span>[<span class="type">Id</span>, <span class="type">E</span>, <span class="type">A</span>](f)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的<code>ReaderT</code>是<code>Monad Transformers</code>。</p>
<h3 id="making-monads">Making monads</h3>
<blockquote>
<p>In this section, we’re going to look at an example of how a type gets made, identified as a monad and then given the appropriate Monad instance. … What if we wanted to model a non-deterministic value like [3,5,9], but we wanted to express that 3 has a 50% chance of happening and 5 and 9 both have a 25% chance of happening?</p>
</blockquote>
<p>由于<code>Scala</code>没有内置的分数，所以我们直接使用<code>Double</code></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Prob</span>[<span class="type">A</span>](<span class="params">list: <span class="type">List</span>[(<span class="type">A</span>, <span class="type">Double</span></span>)])</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">trait</span> <span class="title">ProbInstances</span> </span>&#123;</span><br><span class="line">  <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">probShow</span></span>[<span class="type">A</span>]: <span class="type">Show</span>[<span class="type">Prob</span>[<span class="type">A</span>]] = <span class="type">Show</span>.showA</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">object</span> <span class="title">Prob</span> <span class="keyword">extends</span> <span class="title">ProbInstances</span></span></span><br></pre></td></tr></table></figure>
<p>由于<code>List</code>是<code>functor</code>，好像<code>Prob</code>本身也应该是个<code>functor</code>。我们给他加上<code>map</code>。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">ProbInstances</span> </span>&#123;</span><br><span class="line">  <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">probShow</span></span>[<span class="type">A</span>]: <span class="type">Show</span>[<span class="type">Prob</span>[<span class="type">A</span>]] = <span class="type">Show</span>.showA</span><br><span class="line">  <span class="keyword">implicit</span> <span class="keyword">val</span> probInstance = <span class="keyword">new</span> <span class="type">Functor</span>[<span class="type">Prob</span>] &#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">map</span></span>[<span class="type">A</span>, <span class="type">B</span>](fa: <span class="type">Prob</span>[<span class="type">A</span>])(f: <span class="type">A</span> =&gt; <span class="type">B</span>): <span class="type">Prob</span>[<span class="type">B</span>] = </span><br><span class="line">      <span class="type">Prob</span>(fa.list map &#123; <span class="keyword">case</span> (x, p) =&gt; (f(x), p)&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来先实现<code>flatten</code>，我们先确定一下语义，<code>[([(1,0.5),(2, 0.5), 0.3]), ([(4, 0.3), (3, 0.7)], 0.4), 0.7)]</code>在<code>flatten</code>之后应该是<code>[(1, 0.15), (2, 0.15),(4, 0.21), (3, 0.49)]</code>。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flatten</span></span>[<span class="type">B</span>](xs: <span class="type">Prob</span>[<span class="type">Prob</span>[<span class="type">B</span>]]): <span class="type">Prob</span>[<span class="type">B</span>] = &#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">multall</span></span>(innerxs: <span class="type">Prob</span>[<span class="type">B</span>], p: <span class="type">Double</span>) =</span><br><span class="line">      innerxs.list map &#123; <span class="keyword">case</span> (x, r) =&gt; (x, p * r)&#125;</span><br><span class="line">    <span class="type">Prob</span>((xs.list map &#123;<span class="keyword">case</span> (innerxs, p) =&gt; multall(innerxs, p)&#125;).flatten)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>最后，我们实现<code>Monad</code>。实现需要实现<code>point</code>和<code>bind</code>两个函数。其中<code>Point</code>相当于<code>return</code>即返回包含值的最小上下文。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">point</span></span>[<span class="type">A</span>](a : =&gt; <span class="type">A</span>): <span class="type">Prob</span>[<span class="type">A</span>] = <span class="type">Prob</span>(<span class="type">List</span>((a, <span class="number">1.0</span>)))</span><br></pre></td></tr></table></figure>
<p>然后是函数<code>bind</code>,他可以简单通过<code>map</code>和<code>flatten</code>完成。顺便加一个用来合并相同项的辅助函数<code>collected</code>。最后的结果</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Prob</span>[<span class="type">A</span>](<span class="params">list: <span class="type">List</span>[(<span class="type">A</span>, <span class="type">Double</span></span>)])</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">trait</span> <span class="title">ProbInstances</span> </span>&#123;</span><br><span class="line">  <span class="keyword">implicit</span> <span class="function"><span class="keyword">def</span> <span class="title">probShow</span></span>[<span class="type">A</span>]: <span class="type">Show</span>[<span class="type">Prob</span>[<span class="type">A</span>]] = <span class="type">Show</span>.showA</span><br><span class="line">  <span class="keyword">implicit</span> <span class="keyword">val</span> probInstance = <span class="keyword">new</span> <span class="type">Functor</span>[<span class="type">Prob</span>] <span class="keyword">with</span> <span class="type">Monad</span>[<span class="type">Prob</span>] &#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">point</span></span>[<span class="type">A</span>](a : =&gt; <span class="type">A</span>): <span class="type">Prob</span>[<span class="type">A</span>] = <span class="type">Prob</span>(<span class="type">List</span>((a, <span class="number">1.0</span>)))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bind</span></span>[<span class="type">A</span>, <span class="type">B</span>](fa: <span class="type">Prob</span>[<span class="type">A</span>])(f: <span class="type">A</span> =&gt; <span class="type">Prob</span>[<span class="type">B</span>]): <span class="type">Prob</span>[<span class="type">B</span>] =</span><br><span class="line">      flatten(map(fa)(f))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">map</span></span>[<span class="type">A</span>, <span class="type">B</span>](fa: <span class="type">Prob</span>[<span class="type">A</span>])(f: <span class="type">A</span> =&gt; <span class="type">B</span>): <span class="type">Prob</span>[<span class="type">B</span>] =</span><br><span class="line">      <span class="type">Prob</span>(fa.list map &#123; <span class="keyword">case</span> (x, p) =&gt; (f(x), p)&#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">flatten</span></span>[<span class="type">B</span>](xs: <span class="type">Prob</span>[<span class="type">Prob</span>[<span class="type">B</span>]]): <span class="type">Prob</span>[<span class="type">B</span>] = &#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">multall</span></span>(innerxs: <span class="type">Prob</span>[<span class="type">B</span>], p: <span class="type">Double</span>) =</span><br><span class="line">      innerxs.list map &#123; <span class="keyword">case</span> (x, r) =&gt; (x, p * r)&#125;</span><br><span class="line">    <span class="type">Prob</span>((xs.list map &#123;<span class="keyword">case</span> (innerxs, p) =&gt; multall(innerxs, p)&#125;).flatten)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">collected</span></span>[<span class="type">B</span>](xs: <span class="type">Prob</span>[<span class="type">B</span>]): <span class="type">Prob</span>[<span class="type">B</span>] = &#123;</span><br><span class="line">    <span class="type">Prob</span>(xs.list.foldRight(<span class="type">Map</span>[<span class="type">B</span>, <span class="type">Double</span>]())((x, y) =&gt; &#123;</span><br><span class="line">      y get x._1 <span class="keyword">match</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="type">Some</span>(v) =&gt; y + (x._1 -&gt; (x._2 + v))</span><br><span class="line">        <span class="keyword">case</span> <span class="type">None</span> =&gt; y + (x._1 -&gt; x._2)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).toList)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">object</span> <span class="title">Prob</span> <span class="keyword">extends</span> <span class="title">ProbInstances</span></span></span><br></pre></td></tr></table></figure>
<h4 id="coin-example">Coin example</h4>
<p>可以使用一个硬币的例子看看效果</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">trait</span> <span class="title">Coin</span></span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">object</span> <span class="title">Heads</span> <span class="keyword">extends</span> <span class="title">Coin</span></span></span><br><span class="line"><span class="class"><span class="title">case</span> <span class="title">object</span> <span class="title">Tails</span> <span class="keyword">extends</span> <span class="title">Coin</span></span></span><br><span class="line"><span class="class"><span class="title">implicit</span> <span class="title">val</span> <span class="title">coinEqual</span></span>: <span class="type">Equal</span>[<span class="type">Coin</span>] = <span class="type">Equal</span>.equalA</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">coin</span></span>: <span class="type">Prob</span>[<span class="type">Coin</span>] = <span class="type">Prob</span>(<span class="type">Heads</span> -&gt; <span class="number">0.5</span> :: <span class="type">Tails</span> -&gt; <span class="number">0.5</span> :: <span class="type">Nil</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadedCoin</span></span>: <span class="type">Prob</span>[<span class="type">Coin</span>] = <span class="type">Prob</span>(<span class="type">Heads</span> -&gt; <span class="number">0.1</span> :: <span class="type">Tails</span> -&gt; <span class="number">0.9</span> :: <span class="type">Nil</span>)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">lazy</span> <span class="keyword">val</span> flipThree: <span class="type">Prob</span>[<span class="type">List</span>[<span class="type">Coin</span>]] = <span class="keyword">for</span> &#123;</span><br><span class="line">  a &lt;- coin</span><br><span class="line">  b &lt;- coin</span><br><span class="line">  c &lt;- loadedCoin</span><br><span class="line">&#125; <span class="keyword">yield</span> &#123; <span class="type">List</span>(a, b, c)&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">Prob</span>.collected(flipThree map &#123; _ all &#123;_ === <span class="type">Tails</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>这里可以看出来，我们利用<code>for</code>的语法糖，构建了一个Coin的序列，然后从里面找出来全都是<code>Tails</code>的，然后计算出来概率，虽然感觉复杂度有点高，但是很直观。</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Scala/" rel="tag"># Scala</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/03/29/ty-level2/" rel="next" title="Type-Level Programming in Scala-2">
                <i class="fa fa-chevron-left"></i> Type-Level Programming in Scala-2
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/05/15/scalazday8/" rel="prev" title="learning Scalaz-day8">
                learning Scalaz-day8 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">ariwaranosai</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">47</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">36</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#tasteful-stateful-computations"><span class="nav-number">1.</span> <span class="nav-text">Tasteful stateful computations</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#state-and-statet"><span class="nav-number">2.</span> <span class="nav-text">State and StateT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#composing-monadic-functions"><span class="nav-number">3.</span> <span class="nav-text">Composing monadic functions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#kleisli"><span class="nav-number">3.1.</span> <span class="nav-text">Kleisli</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reader-as-kleisli"><span class="nav-number">3.2.</span> <span class="nav-text">Reader as Kleisli</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#making-monads"><span class="nav-number">4.</span> <span class="nav-text">Making monads</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#coin-example"><span class="nav-number">4.1.</span> <span class="nav-text">Coin example</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ariwaranosai</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.7.0</div>


<!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": { 
        preferredFont: "TeX", 
        availableFonts: ["STIX","TeX"], 
        linebreaks: { automatic:true }, 
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) 
    },
    tex2jax: { 
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ], 
        processEscapes: true, 
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {  
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, 
        Macros: { href: "{}" } 
    },
    messageStyle: "none"
    }); 
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>



        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=6.7.0"></script>



  
  <script src="/js/src/scrollspy.js?v=6.7.0"></script>
<script src="/js/src/post-details.js?v=6.7.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->



  


  


  





  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
